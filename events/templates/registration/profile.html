{% extends 'base.html' %}
{% block content %}
<section class="card" style="max-width:1000px;margin:18px auto">
  <div style="display:flex;gap:20px;align-items:center">
    <div style="flex:1">
      <h2>Profil — {{ user_obj.username }}</h2>
      <p class="muted">{{ user_obj.email }}</p>
      {% if user_obj.bio %}<p>{{ user_obj.bio }}</p>{% endif %}
      <p><strong>Intérêts:</strong>
        {% for it in interests %}
          <span class="muted">{{ it.name }}</span>{% if not forloop.last %}, {% endif %}
        {% empty %}
          <span class="muted">Aucun intérêt défini</span>
        {% endfor %}
      </p>
    </div>
    <div style="width:220px;text-align:right">
      <form action="{% url 'logout' %}" method="post" style="display:inline">
        {% csrf_token %}
        <button type="submit" class="btn-outline" style="border:none;background:none;padding:0;font:inherit;cursor:pointer">Se déconnecter</button>
      </form>
    </div>
  </div>
</section>

<section class="card" style="max-width:1000px;margin:18px auto">
  <h3>Réservations à venir</h3>
  {% if upcoming_tickets.exists %}
    <div class="events-grid">
      {% for t in upcoming_tickets %}
        <div class="card">
          <h4>{{ t.event.title }}</h4>
          <p class="muted">{{ t.event.date }}</p>
          <p>Réf: <strong>{{ t.reference }}</strong></p>
          <p>Statut: {{ t.status }}</p>
          {% if t.qr_code %}<p><a href="{{ t.qr_code.url }}">Voir QR</a></p>{% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="muted">Aucune réservation à venir.</p>
  {% endif %}
</section>

<section class="card" style="max-width:1000px;margin:18px auto">
  <h3>Historique</h3>
  {% if history.exists %}
    <ul>
      {% for h in history %}
        <li>{{ h.event.title }} — {% if h.attended_at %}participé le {{ h.attended_at }}{% else %}inscrit{% endif %}</li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="muted">Aucun historique enregistré.</p>
  {% endif %}
</section>

{% endblock %}
